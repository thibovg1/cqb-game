-
<!DOCTYPE html>
<html lang="nl">

<head>
    <meta charset="UTF-8">
    <title>CQB Ops: Fixed Spawn</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #000;
            font-family: 'Consolas', monospace;
        }

        #crosshair {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 10px;
            height: 10px;
            border: 1px solid #ff0000;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
        }

        #ui {
            position: absolute;
            bottom: 30px;
            left: 30px;
            color: #0f0;
            text-shadow: 2px 2px 4px #000;
            z-index: 5;
        }

        #instructions {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            text-align: center;
            background: rgba(0, 0, 0, 0.95);
            padding: 40px;
            border: 1px solid #333;
            z-index: 20;
        }
    </style>
</head>

<body>

    <div id="crosshair"></div>
    <div id="instructions">
        <h2 style="color: #00ff00;">TACTICAL ENTRY</h2>
        <p>Als je vastzit in een muur: pas PLAYER_SPAWN aan in de code.</p>
        <p><b>KLIK OM TE STARTEN</b></p>
        <small>WASD: Move | Muis: Shoot</small>
    </div>

    <div id="ui">
        [SYSTEM STATUS: ONLINE]<br>
        CURRENT POS: <span id="pos-display">0, 0, 0</span><br>
        ENEMY CONTACTS: <span id="enemy-count">0</span>
    </div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { PointerLockControls } from 'three/addons/controls/PointerLockControls.js';
        import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';

        // ==========================================
        // STAP 1: PAS HIER JE SPAWN AAN
        // ==========================================
        // Als je in het donker spawnt, zet Z op 20 of -20 om "buiten" te beginnen.
        const PLAYER_SPAWN = { x: 0, y: 1.8, z: 15 };

        const ENEMY_SPAWN_POINTS = [
            { x: 2, y: 1, z: -5 },
            { x: -5, y: 1, z: -8 }
        ];

        // ==========================================
        // SCENE & ENGINE
        // ==========================================
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x050505);

        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        // We zetten de camera DIRECT op de spawn positie
        camera.position.set(PLAYER_SPAWN.x, PLAYER_SPAWN.y, PLAYER_SPAWN.z);

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        document.body.appendChild(renderer.domElement);

        const controls = new PointerLockControls(camera, document.body);
        document.body.addEventListener('click', () => controls.lock());

        // Verlichting (Essentieel om je huis te zien!)
        const ambient = new THREE.AmbientLight(0xffffff, 0.2);
        scene.add(ambient);

        const flashlight = new THREE.SpotLight(0xffffff, 80, 50, Math.PI / 6, 0.5);
        flashlight.castShadow = true;
        camera.add(flashlight);
        flashlight.target.position.z = -1;
        camera.add(flashlight.target);
        scene.add(camera);

        // ==========================================
        // ASSETS LADEN
        // ==========================================
        const obstacles = [];
        const enemies = [];
        const loader = new GLTFLoader();

        loader.load('huis.glb', (gltf) => {
            const model = gltf.scene;
            scene.add(model);

            model.traverse((node) => {
                if (node.isMesh) {
                    node.receiveShadow = true;
                    node.castShadow = true;
                    obstacles.push(node);
                }
            });
            spawnEnemies();
            console.log("Huis geladen op positie:", model.position);
        }, undefined, (err) => {
            console.error("Kan huis.glb niet vinden. Zorg dat het in dezelfde map staat!");
        });

        function spawnEnemies() {
            const enemyGeo = new THREE.CapsuleGeometry(0.4, 1, 4, 8);
            const enemyMat = new THREE.MeshStandardMaterial({ color: 0xff0000 });
            ENEMY_SPAWN_POINTS.forEach(pos => {
                const e = new THREE.Mesh(enemyGeo, enemyMat);
                e.position.set(pos.x, pos.y, pos.z);
                e.userData = { alive: true };
                scene.add(e);
                enemies.push(e);
            });
            document.getElementById('enemy-count').innerText = enemies.length;
        }

        // ==========================================
        // GAME LOGICA & MOVEMENT
        // ==========================================
        const keys = {};
        window.addEventListener('keydown', (e) => keys[e.code] = true);
        window.addEventListener('keyup', (e) => keys[e.code] = false);

        const raycaster = new THREE.Raycaster();
        const velocity = new THREE.Vector3();
        let prevTime = performance.now();

        function animate() {
            requestAnimationFrame(animate);
            if (controls.isLocked) {
                const time = performance.now();
                const delta = (time - prevTime) / 1000;

                velocity.x -= velocity.x * 10.0 * delta;
                velocity.z -= velocity.z * 10.0 * delta;

                if (keys['KeyW']) velocity.z -= 100.0 * delta;
                if (keys['KeyS']) velocity.z += 100.0 * delta;
                if (keys['KeyA']) velocity.x -= 100.0 * delta;
                if (keys['KeyD']) velocity.x += 100.0 * delta;

                controls.moveRight(-velocity.x * delta);
                controls.moveForward(-velocity.z * delta);

                // Update UI Positie
                document.getElementById('pos-display').innerText =
                    `X: ${camera.position.x.toFixed(1)}, Z: ${camera.position.z.toFixed(1)}`;

                prevTime = time;
            }
            renderer.render(scene, camera);
        }
        animate();

        // Schieten
        window.addEventListener('mousedown', () => {
            if (!controls.isLocked) return;
            raycaster.setFromCamera({ x: 0, y: 0 }, camera);
            const hits = raycaster.intersectObjects(enemies);
            if (hits.length > 0) {
                const target = hits[0].object;
                target.rotation.z = Math.PI / 2;
                target.position.y = 0.2;
                target.userData.alive = false;
                const aliveCount = enemies.filter(e => e.userData.alive).length;
                document.getElementById('enemy-count').innerText = aliveCount;
            }
        });

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>

</html>